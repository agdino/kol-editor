<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>KOL è³‡æ–™äº’å‹•ç·¨è¼¯ç³»çµ±</title>
  <style>
    body {{ font-family: sans-serif; margin: 20px; }}
    #form label {{ font-weight: bold; margin-top: 8px; }}
    #form input {{ margin-bottom: 6px; }}
    .row {{ padding: 5px; cursor: pointer; border-bottom: 1px solid #eee; }}
    .row:hover {{ background-color: #f0f0f0; }}
  </style>
</head>
<body>
  <h1>KOL è³‡æ–™äº’å‹•ç·¨è¼¯ç³»çµ±</h1>
  <a href="https://docs.google.com/spreadsheets/d/1Benpo3LKBAfhRAVaI9h_h4lDMiMxqxl6B53zTp-KkqM/edit?gid=527810604" target="_blank">ğŸ“„ å‰å¾€åŸå§‹è¡¨å–®</a>
  <button onclick="addNewRow()">â• æ–°å¢è³‡æ–™</button>
  <div style="display: flex; gap: 20px;">
    <form id="form" style="flex: 2; display: flex; flex-direction: column;"></form>
    <div id="row-list" style="flex: 1; max-height: 70vh; overflow-y: auto; border: 1px solid #ccc; padding: 10px;"></div>
  </div>
  <div style="margin-top: 10px;">
    <button onclick="saveData()">ğŸ’¾ å„²å­˜</button>
    <button onclick="clearForm()">âŒ å–æ¶ˆ</button>
  </div>

  <script>
    const apiUrl = "https://script.google.com/macros/s/AKfycbzocExluFPJE4sufnJUn2ofUZlMMqeJo9sfBmnPZW0NlO7w9JNT3OGAOQek4yfoT8o/exec";
    let headers = [];
    let rows = [];
    let currentRow = null;

    async function loadData() {{
      const res = await fetch(apiUrl);
      const data = await res.json();
      headers = (data.headers || []).filter(h => h && h.trim() !== "");
      rows = data.rows || [];

      const list = document.getElementById("row-list");
      list.innerHTML = "";
      rows.forEach((r, i) => {{
        const item = document.createElement("div");
        item.className = "row";
        item.textContent = r["No."] || ("No." + (i + 1));
        item.onclick = () => fillForm(r);
        list.appendChild(item);
      }});

      const form = document.getElementById("form");
      form.innerHTML = "";
      headers.forEach(h => {{
        const label = document.createElement("label");
        label.textContent = h;
        const input = document.createElement("input");
        input.name = h;
        form.appendChild(label);
        form.appendChild(input);
      }});
    }}

    function fillForm(row) {{
      currentRow = row;
      headers.forEach(h => {{
        const input = document.querySelector(`input[name="${{h}}"]`);
        if (input) input.value = row[h] || "";
      }});
    }}

    function clearForm() {{
      currentRow = null;
      document.querySelectorAll("#form input").forEach(i => i.value = "");
    }}

    async function saveData() {{
      if (!currentRow) return alert("è«‹å…ˆé¸å–ä¸€ç­†è³‡æ–™");
      const newData = {{}};
      document.querySelectorAll("#form input").forEach(i => newData[i.name] = i.value);
      const res = await fetch(apiUrl, {{
        method: "POST",
        body: JSON.stringify(newData)
      }});
      alert("âœ… å·²å„²å­˜");
      loadData();
    }}

    async function addNewRow() {{
      const res = await fetch(apiUrl + "?mode=empty");
      const result = await res.json();
      if (!result.empty) return alert("âŒ æ²’æœ‰å¯ç”¨çš„ç©ºç™½åˆ—");
      currentRow = result.empty;
      fillForm(currentRow);
    }}

    window.onload = loadData;
  </script>
</body>
</html>
